# React Query ìºì‹œëŠ” ì–¸ì œ, ì–´ë””ì—, ì–´ë–¤ í˜•íƒœë¡œ ì €ì¥ë˜ëŠ” ìºì‹œì¼ê¹Œ?

í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì„ í•˜ë‹¤ ë³´ë©´ ë°ì´í„° í˜ì¹­ê³¼ ìƒíƒœ ê´€ë¦¬ì— ëŒ€í•œ ê³ ë¯¼ì€ ëŠì„ì—†ì´ ì´ì–´ì§„ë‹¤. íŠ¹íˆ React ìƒíƒœê³„ì—ì„œëŠ” ì´ëŸ¬í•œ ê³ ë¯¼ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ë‹¤ì–‘í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ ì¡´ì¬í•˜ëŠ”ë°, ê·¸ ì¤‘ì—ì„œë„ TanStack Query(êµ¬ React Query)ëŠ” ë°ì´í„° í˜ì¹­ê³¼ ìºì‹±ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ë„êµ¬ë¡œ ìë¦¬ ì¡ì•˜ë‹¤. ê·¸ëŸ°ë° ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ í•œ ê°€ì§€ ê¶ê¸ˆì¦ì´ ìƒê¸¸ ìˆ˜ ìˆë‹¤. "React QueryëŠ” ëŒ€ì²´ ì–´ë””ì— ìºì‹œë¥¼ ì €ì¥í•˜ëŠ” ê±¸ê¹Œ?"

> (ğŸ‘¨ğŸ»â€ğŸ« : "ì—¬ëŸ¬ë¶„, ë©´ì ‘ì—ì„œë„ ìì£¼ ë¬¼ì–´ë³´ëŠ” ì§ˆë¬¸ì¸ë°ìš”! ë§ì€ ë¶„ë“¤ì´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë‚˜ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ë¼ê³  ëŒ€ë‹µí•˜ì‹œê³¤ í•˜ì£ . ê³¼ì—° ì •ë‹µì€ ë¬´ì—‡ì¼ê¹Œìš”?")
> 

ì´ ê¸€ì—ì„œëŠ” React Queryì˜ ìºì‹± ë©”ì»¤ë‹ˆì¦˜ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ê³ , ì‹¤ì œë¡œ ìºì‹œê°€ ì–´ë””ì— ì €ì¥ë˜ëŠ”ì§€, ê·¸ë¦¬ê³  í•„ìš”ì— ë”°ë¼ ì–´ë–»ê²Œ ì˜êµ¬ ì €ì¥ì†Œì— ìºì‹œë¥¼ ìœ ì§€í•  ìˆ˜ ìˆëŠ”ì§€ ì‚´í´ë³¼ ê²ƒì´ë‹¤.

## ğŸ’¡ê¸‰í•˜ì‹  ë¶„ë“¤ì„ ìœ„í•´ì„œ ê²°ë¡  ë¨¼ì €!

1. React QueryëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **JavaScriptì˜ ëŸ°íƒ€ì„ ë©”ëª¨ë¦¬(RAM)**ì— ìºì‹œë¥¼ ì €ì¥í•œë‹¤.
2. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ì´ë‚˜ ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œ ìºì‹œëŠ” **ëª¨ë‘ ì‚¬ë¼ì§„ë‹¤.**
3. ì˜êµ¬ ì €ì¥ì´ í•„ìš”í•˜ë‹¤ë©´ **persistQueryClient** í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ì—¬ localStorage ë“±ì— ì €ì¥í•  ìˆ˜ ìˆë‹¤.
4. ìºì‹œëŠ” **ì¼ë°˜ JavaScript ê°ì²´** í˜•íƒœë¡œ ì €ì¥ë˜ë©°, ì¿¼ë¦¬ í‚¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì„±ëœë‹¤.
5. **gcTime**ê³¼ **staleTime** ì†ì„±ì´ ìºì‹œì˜ ìˆ˜ëª…ê³¼ ì‹ ì„ ë„ë¥¼ ê²°ì •í•œë‹¤.

## 1. React Queryì˜ ê¸°ë³¸ ìºì‹± ë©”ì»¤ë‹ˆì¦˜

## ìºì‹œ ì €ì¥ ìœ„ì¹˜: ë©”ëª¨ë¦¬

React QueryëŠ” ëª¨ë“  ìºì‹œ ë°ì´í„°ë¥¼ **JavaScriptì˜ ëŸ°íƒ€ì„ ë©”ëª¨ë¦¬**ì— ì €ì¥í•œë‹¤. ì´ëŠ” ë¸Œë¼ìš°ì €ì˜ RAMì— ì„¸ì…˜ ë™ì•ˆë§Œ ìœ ì§€ë˜ëŠ” ë°©ì‹ì´ë‹¤. ì´ê²ƒì€ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë‚˜ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€, IndexedDBì™€ ê°™ì€ ë¸Œë¼ìš°ì €ì˜ ì˜êµ¬ ì €ì¥ì†Œì™€ëŠ” ë‹¤ë¥¸ ê°œë…ì´ë‹¤.

> (ğŸ‘¨ğŸ»â€ğŸ« : "ë§ì€ ë¶„ë“¤ì´ ì˜¤í•´í•˜ì‹œëŠ” ë¶€ë¶„ì¸ë°ìš”, React QueryëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ì—ë§Œ ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ë‚ ì•„ê°€ë²„ë¦°ë‹µë‹ˆë‹¤! ì™œ ë‚ ì•„ê°ˆê¹Œìš”? ")
> 

### ìƒˆë¡œê³ ì¹¨ ì‹œ ê³¼ì •

1. **í˜„ì¬ í˜ì´ì§€ì˜ ë¦¬ì†ŒìŠ¤ íê¸°**: ë¸Œë¼ìš°ì €ëŠ” í˜„ì¬ ë¡œë“œëœ í˜ì´ì§€ì˜ ëª¨ë“ Â JavaScript ì½”ë“œ, DOMÂ ìš”ì†Œ, **ë©”ëª¨ë¦¬ì— ì €ì¥ëœÂ ëª¨ë“  ë°ì´í„°ë¥¼ ì™„ì „íˆ íê¸°ë¨**.
2. **ìƒˆ í˜ì´ì§€ ìš”ì²­Â ì‹œì‘**: ë¸Œë¼ìš°ì €ëŠ” ì„œë²„ì— í˜„ì¬ URLì— ëŒ€í•œ ìƒˆë¡œìš´ HTTPÂ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
3. **ìƒˆ í˜ì´ì§€Â ë¡œë“œ ë° ì‹¤í–‰**: ì„œë²„ë¡œë¶€í„° ì‘ë‹µì„ ë°›ì€ í›„, ë¸Œë¼ìš°ì €ëŠ”Â HTML, CSS, JavaScript ë“± ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ë¡œë“œí•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.

ì´ ê³¼ì •ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ì ì€Â **ëª¨ë“  ë©”ëª¨ë¦¬ê°€ ì´ˆê¸°í™”ëœë‹¤**ëŠ” ê²ƒì´ë‹¤.Â ì¦‰, JavaScript ëŸ°íƒ€ì„Â í™˜ê²½ì´ ì™„ì „íˆ ì¬ì„¤ì •ëœë‹¤. ë”°ë¼ì„œ, React Query ì™€ ê°™ì´ JS ëŸ°íƒ€ì„ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ëŠ” ê²½ìš°ì—ëŠ” ìƒˆë¡œê³ ì¹¨ì‹œ, ìºì‹œë¥¼ í•´ë‘ì—ˆë˜ ë‚´ìš©ì´ ì „ë¶€ ì‚¬ë¼ì§„ë‹¤.

> (ğŸ‘¨ğŸ»â€ğŸ« : "JS ê°ì²´ë¡œ ì„±ëŠ¥ ê°œì„ ì„ í•œ ê²ƒ ì¤‘ì— ëŒ€í‘œì ì¸ ê²ƒì„ ê¼½ìë©´ Virtual DOMì„ ê¼½ì„ ìˆ˜ ìˆëŠ”ë°ìš”? Virtual DOM ë˜í•œ DOM ì˜ ì–•ì€ ë³µì‚¬ë³¸ìœ¼ë¡œ, ì´ ë˜í•œ JS ê°ì²´ì…ë‹ˆë‹¤. React ëŠ” ê¸°ì¡´ì˜ ë¬´ê±°ìš´ DOMì—ì„œ Virtual DOMì„ ì ìš©í•´ ë¹„êµ(diffing)ì— ìˆì–´ì„œ, í›¨ì”¬ ë¹ ë¥¸ ì†ë„ë¥¼ ì´ëŒì–´ë‚¸ ê²ƒê³¼ ë¹„ìŠ·í•˜ë‹¤ê³  ë³¼ ìˆ˜ ìˆê² ì£ ? ê·¸ëŸ¬ë‚˜, ë§ˆëƒ¥ ì¢‹ì€ ê²ƒë§Œì€ ì•„ë‹™ë‹ˆë‹¤. ë©”ëª¨ë¦¬ëŠ” ë¹ ë¥´ì§€ë§Œ íœ˜ë°œì„±ì´ ìˆì–´ìš”. ì „ì›ì´ êº¼ì§€ë©´ ë°ì´í„°ê°€ ëª¨ë‘ ì‚¬ë¼ì§€ëŠ” ê²ƒì²˜ëŸ¼, í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ React Queryì˜ ìºì‹œë„ ëª¨ë‘ ì‚¬ë¼ì§„ë‹µë‹ˆë‹¤. í—ˆê±°ë©~~ ğŸ˜¨")
> 

### ìºì‹œì˜ êµ¬ì¡°

React Queryì˜ ìºì‹œëŠ” **QueryCache**ë¼ëŠ” **JS ê°ì²´**ì— ì˜í•´ ê´€ë¦¬ëœë‹¤. ì´ ê°ì²´ëŠ” **ëª¨ë“  ì¿¼ë¦¬ì˜ ë°ì´í„°, ë©”íƒ€ ì •ë³´ ë° ìƒíƒœë¥¼ ì €ì¥**í•œë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ê°œë°œìëŠ” QueryCacheì™€ ì§ì ‘ ìƒí˜¸ì‘ìš©í•˜ì§€ ì•Šê³ , queryKeyë¥¼ í†µí•´ì„œ QueryClientë¥¼ í†µí•´ íŠ¹ì • ìºì‹œì— ì ‘ê·¼í•œë‹¤.

```jsx
import { QueryCache } from '@tanstack/react-query'

const queryCache = new QueryCache({
  onError: (error) => {
    console.log(error)
  },
  onSuccess: (data) => {
    console.log(data)
  },
  onSettled: (data, error) => {
    console.log(data, error)
  },
})

const query = queryCache.find(['posts'])
```

ì¶œì²˜: https://tanstack.com/query/v5/docs/reference/QueryCache

## 2. ë©”ëª¨ë¦¬ ê¸°ë°˜ ìºì‹±ì˜ ì¥ë‹¨ì 

### ì¥ì : ë¹ ë¥¸ ì ‘ê·¼ ì†ë„

ë©”ëª¨ë¦¬ ê¸°ë°˜ ìºì‹±ì˜ ê°€ì¥ í° ì¥ì ì€ **ì ‘ê·¼ ì†ë„ê°€ ë§¤ìš° ë¹ ë¥´ë‹¤**ëŠ” ì ì´ë‹¤. ë””ìŠ¤í¬ ê¸°ë°˜ ì €ì¥ì†Œì— ë¹„í•´ ë©”ëª¨ë¦¬ëŠ” í›¨ì”¬ ë¹ ë¥¸ ì½ê¸°/ì“°ê¸° ì„±ëŠ¥ì„ ì œê³µí•˜ë¯€ë¡œ, ì‚¬ìš©ì ê²½í—˜ ì¸¡ë©´ì—ì„œ í° ì´ì ì„ ê°€ì§„ë‹¤.

### ë‹¨ì : íœ˜ë°œì„±

ë°˜ë©´, ë©”ëª¨ë¦¬ ê¸°ë°˜ ìºì‹±ì˜ ê°€ì¥ í° ë‹¨ì ì€ **íœ˜ë°œì„±**ì´ë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ë¸Œë¼ìš°ì €ë¥¼ ë‹«ìœ¼ë©´ ëª¨ë“  ìºì‹œ ë°ì´í„°ê°€ ì‚¬ë¼ì§„ë‹¤. ì´ëŠ” ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ ë‹¤ì‹œ ë°©ë¬¸í•  ë•Œ ëª¨ë“  ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì™€ì•¼ í•¨ì„ ì˜ë¯¸í•œë‹¤.

### gcTimeê³¼ staleTime

React QueryëŠ” **gcTime**(ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì‹œê°„)ê³¼ **staleTime**(ë°ì´í„° ì‹ ì„ ë„ ì‹œê°„)ì´ë¼ëŠ” ë‘ ê°€ì§€ ì¤‘ìš”í•œ ì†ì„±ì„ í†µí•´ ìºì‹œì˜ ìˆ˜ëª…ê³¼ ì‹ ì„ ë„ë¥¼ ê´€ë¦¬í•œë‹¤.

- **staleTime**: ë°ì´í„°ê°€ 'ì‹ ì„ 'í•˜ë‹¤ê³  ê°„ì£¼ë˜ëŠ” ì‹œê°„. ì´ ì‹œê°„ ë™ì•ˆì€ ì¿¼ë¦¬ê°€ ë‹¤ì‹œ ë§ˆìš´íŠ¸ë˜ì–´ë„ **ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤**.
- **gcTime**: **ë¹„í™œì„± ì¿¼ë¦¬ê°€ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°ë˜ê¸°ê¹Œì§€ì˜ ì‹œê°„**. ê¸°ë³¸ê°’ì€ 5ë¶„ì´ë‹¤.

```jsx
const { data } = useQuery({
  queryKey: ['todos'],
  queryFn: fetchTodos,
  staleTime: 1000 * 60 * 5, *// 5ë¶„*
  gcTime: 1000 * 60 * 60, *// 1ì‹œê°„*
})
```

> (ğŸ‘¨ğŸ»â€ğŸ« : "JS ê°ì²´ë¡œ ì„±ëŠ¥ ê°œì„ ì„ í•œ ê²ƒ ì¤‘ì— ëŒ€í‘œì ì¸ ê²ƒì„ ê¼½ìë©´ Virtual DOMì„ ê¼½ì„ ìˆ˜ ìˆëŠ”ë°ìš”? Virtual DOM ë˜í•œ DOM ì˜ ì–•ì€ ë³µì‚¬ë³¸ìœ¼ë¡œ, JS ê°ì²´ì…ë‹ˆë‹¤. React ëŠ” ê¸°ì¡´ì˜ ë¬´ê±°ìš´ DOMì—ì„œ Virtual DOMì„ ì ìš©í•´ ë¹„êµ(diffing)ì— ìˆì–´ì„œ, í›¨ì”¬ ë¹ ë¥¸ ì†ë„ë¥¼ ì´ëŒì–´ë‚¸ ê²ƒê³¼ ë¹„ìŠ·í•˜ë‹¤ê³  ë³¼ ìˆ˜ ìˆê² ì£ ? ê·¸ëŸ¬ë‚˜, ë§ˆëƒ¥ ì¢‹ì€ ê²ƒë§Œì€ ì•„ë‹™ë‹ˆë‹¤. ë©”ëª¨ë¦¬ëŠ” ë¹ ë¥´ì§€ë§Œ íœ˜ë°œì„±ì´ ìˆì–´ìš”. ì „ì›ì´ êº¼ì§€ë©´ ë°ì´í„°ê°€ ëª¨ë‘ ì‚¬ë¼ì§€ëŠ” ê²ƒì²˜ëŸ¼, í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ React Queryì˜ ìºì‹œë„ ëª¨ë‘ ì‚¬ë¼ì§„ë‹µë‹ˆë‹¤. í—ˆê±°ë©~~ ğŸ˜¨Â ê·¸ëŸ¼ ì´ íœ˜ë°œì„±ì„ ì–´ë–»ê²Œ ì œê±°í• ê¹Œìš”?")
> 

## 3. ì˜êµ¬ ì €ì¥ì†Œë¡œ ìºì‹œ ìœ ì§€í•˜ê¸°

### persistQueryClient í”ŒëŸ¬ê·¸ì¸

React QueryëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ì—ë§Œ ìºì‹œë¥¼ ì €ì¥í•˜ì§€ë§Œ, **persistQueryClient** í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ë©´ ìºì‹œë¥¼ ì˜êµ¬ ì €ì¥ì†Œ(localStorage, sessionStorage ë“±)ì— ìœ ì§€í•  ìˆ˜ ìˆë‹¤( ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ì„œëŠ” ìƒˆë¡œ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤ )

```jsx
import { PersistQueryClientProvider } from '@tanstack/react-query-persist-client'
import { createSyncStoragePersister } from '@tanstack/query-sync-storage-persister'

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      gcTime: 1000 * 60 * 60 * 24, *// 24ì‹œê°„*
    },
  },
})

const persister = createSyncStoragePersister({
  storage: window.localStorage,
})

ReactDOM.createRoot(rootElement).render(
  <PersistQueryClientProvider
    client={queryClient}
    persistOptions={{ persister }}
  >
    <App />
  </PersistQueryClientProvider>,
)
```

ì¶œì²˜: https://tanstack.com/query/v5/docs/react/plugins/persistQueryClient

> (ğŸ‘¨ğŸ»â€ğŸ« : "ì´ í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ë©´ React Queryì˜ ìºì‹œë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ê°™ì€ ê³³ì— ì €ì¥í•  ìˆ˜ ìˆì–´ìš”. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ë„ ë°ì´í„°ê°€ ìœ ì§€ëœë‹µë‹ˆë‹¤! ë¬¸ì„œë¥¼ ì½ì–´ë³´ì‹œë©´ [**createSyncStoragePersister](https://tanstack.com/query/v5/docs/framework/react/plugins/createSyncStoragePersister), [createAsyncStoragePersister](https://tanstack.com/query/v5/docs/framework/react/plugins/createAsyncStoragePersister), [create a custom persister](https://tanstack.com/query/v5/docs/framework/react/plugins/persistQueryClient/#persisters) ì´ë ‡ê²Œ ë‚˜ë‰˜ì–´ì ¸ ìˆì–´ìš”! í•œ ë²ˆ ë¹„êµí•´ë³¼ê¹Œìš”?** ")
> 

### React Queryì˜ ë‹¤ì–‘í•œ Persister ë¹„êµ

React Queryì—ì„œ ì œê³µí•˜ëŠ” ë‹¤ì–‘í•œ persisterë“¤ì€ ì¿¼ë¦¬ ìºì‹œë¥¼ ì €ì¥í•˜ëŠ” ë°©ì‹ì— ì°¨ì´ê°€ ìˆë‹¤. ê° persisterì˜ íŠ¹ì§•ê³¼ ì°¨ì´ì ì„ ìì„¸íˆ ì‚´í´ë³´ê² ë‹¤.

### createSyncStoragePersister

`createSyncStoragePersister`ëŠ” ë™ê¸°ì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ìŠ¤í† ë¦¬ì§€ë¥¼ ìœ„í•œ persisterë¥¼ ìƒì„±í•œë‹¤.

**ì£¼ìš” íŠ¹ì§•:**

- ë¸Œë¼ìš°ì €ì˜ `localStorage`ë‚˜ `sessionStorage`ì™€ ê°™ì€ ë™ê¸°ì  ìŠ¤í† ë¦¬ì§€ APIì™€ í•¨ê»˜ ì‚¬ìš©ëœë‹¤.
- **ì›¹ í™˜ê²½ì—ì„œ ì£¼ë¡œ ì‚¬ìš©ëœë‹¤.**
- **ë°ì´í„° ì“°ê¸° ì‘ì—…ì„ ìµœì í™”í•˜ê¸° ìœ„í•´ 1ì´ˆì— ìµœëŒ€ í•œ ë²ˆë§Œ ì €ì¥ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.**
- **êµ¬í˜„ ë°©ë²•ì´ ê°„ë‹¨í•˜ë‹¤.**

**ì‚¬ìš© ì˜ˆì‹œ:**

```jsx
import { persistQueryClient } from '@tanstack/react-query-persist-client'
import { createSyncStoragePersister } from '@tanstack/query-sync-storage-persister'

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      cacheTime: 1000 * 60 * 60 * 24, *// 24ì‹œê°„*
    },
  },
})

const localStoragePersister = createSyncStoragePersister({
  storage: window.localStorage,
})

persistQueryClient({
  queryClient,
  persister: localStoragePersister,
})
```

### createAsyncStoragePersister

`createAsyncStoragePersister`ëŠ” ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ìŠ¤í† ë¦¬ì§€ë¥¼ ìœ„í•œ persisterë¥¼ ìƒì„±í•œë‹¤.

**ì£¼ìš” íŠ¹ì§•:**

- React Nativeì˜ `AsyncStorage`ì™€ ê°™ì€ ë¹„ë™ê¸° ìŠ¤í† ë¦¬ì§€ APIì™€ í•¨ê»˜ ì‚¬ìš©ëœë‹¤.
- **ëª¨ë°”ì¼ ì•± í™˜ê²½ì—ì„œ ì£¼ë¡œ ì‚¬ìš©ëœë‹¤.**
- **ë¹„ë™ê¸° ì‘ì—…ì„ ì§€ì›í•˜ë¯€ë¡œ ëª¨ë°”ì¼ í™˜ê²½ì— ì í•©í•˜ë‹¤.**
- **ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ë„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‘ë™í•  ìˆ˜ ìˆë‹¤.**

**ì‚¬ìš© ì˜ˆì‹œ:**

```jsx
import AsyncStorage from '@react-native-async-storage/async-storage'
import { QueryClient } from '@tanstack/react-query'
import { PersistQueryClientProvider } from '@tanstack/react-query-persist-client'
import { createAsyncStoragePersister } from '@tanstack/query-async-storage-persister'

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      cacheTime: 1000 * 60 * 60 * 24, *// 24ì‹œê°„*
    },
  },
})

const asyncStoragePersister = createAsyncStoragePersister({
  storage: AsyncStorage,
})

const Root = () => (
  <PersistQueryClientProvider
    client={queryClient}
    persistOptions={{ persister: asyncStoragePersister }}
  >
    <App />
  </PersistQueryClientProvider>
)
```

### ì‚¬ìš©ì ì •ì˜ Persister ìƒì„±í•˜ê¸° (ì•„ì§ ì‹¤í—˜ë‹¨ê³„ì„)

ìì‹ ë§Œì˜ ì»¤ìŠ¤í…€ persisterë¥¼ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤. ì´ëŠ” íŠ¹ë³„í•œ ìŠ¤í† ë¦¬ì§€ ìš”êµ¬ì‚¬í•­ì´ ìˆì„ ë•Œ ìœ ìš©í•˜ë‹¤.

**ì£¼ìš” íŠ¹ì§•:**

- `Persister` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì—¬ ìì‹ ë§Œì˜ `persister`ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- `IndexedDB`ì™€ ê°™ì€ ë‹¤ë¥¸ ìŠ¤í† ë¦¬ì§€ ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- íŠ¹ì • ìš”êµ¬ì‚¬í•­ì— ë§ê²Œ ì €ì¥ ë° ë³µì› ë¡œì§ì„ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆí•  ìˆ˜ ìˆë‹¤.

**ì‚¬ìš© ì˜ˆì‹œ (IndexedDB ê¸°ë°˜ persister):**

```jsx
import { get, set, del } from 'idb-keyval'
import { PersistedClient, Persister } from '@tanstack/react-query-persist-client'

export function createIDBPersister(idbValidKey = 'reactQuery') {
  return {
    persistClient: async (client: PersistedClient) => {
      await set(idbValidKey, client)
    },
    restoreClient: async () => {
      return await get<PersistedClient>(idbValidKey)
    },
    removeClient: async () => {
      await del(idbValidKey)
    },
  } as Persister
}
```

### ì£¼ìš” ì°¨ì´ì  ìš”ì•½

| Persister ìœ í˜• | ì‘ë™ ë°©ì‹ | ì£¼ìš” ì‚¬ìš© í™˜ê²½ | ìŠ¤í† ë¦¬ì§€ íƒ€ì… | íŠ¹ì§• |
| --- | --- | --- | --- | --- |
| createSyncStoragePersister | ë™ê¸°ì  | ì›¹ ë¸Œë¼ìš°ì € | localStorage, sessionStorage | ê°„ë‹¨í•œ êµ¬í˜„, 1ì´ˆë‹¹ ìµœëŒ€ 1íšŒ ì €ì¥ |
| createAsyncStoragePersister | ë¹„ë™ê¸°ì  | ëª¨ë°”ì¼ ì•± | AsyncStorage | ë¹„ë™ê¸° ì‘ì—… ì§€ì›, ëª¨ë°”ì¼ í™˜ê²½ì— ìµœì í™” |
| ì»¤ìŠ¤í…€ Persister | ì‚¬ìš©ì ì •ì˜ | íŠ¹ìˆ˜ ìš”êµ¬ì‚¬í•­ | ì‚¬ìš©ì ì •ì˜ (ì˜ˆ: IndexedDB) | ì™„ì „í•œ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥ |

> (ğŸ‘¨ğŸ»â€ğŸ« : "ì™œ SyncStroage(ë™ê¸°) AsyncStorage(ë¹„ë™ê¸°) ë°©ì‹ì— ë”°ë¼, ì›¹ê³¼ ì•±ì—ì„œ ë‹¤ë¥´ê²Œ ì“¸ê¹Œìš”? ã…ã… ì´ê²ƒ ë˜í•œ ë‚˜ì¤‘ì— ë¸”ë¡œê·¸ì—ì„œ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤! ê²°ë¡ ë¶€í„° ì–˜ê¸°í•˜ìë©´ ëª¨ë°”ì¼ í™˜ê²½ì—ì„  ë¦¬ì†ŒìŠ¤ê°€ ì œí•œì ì´ë¼ ë¹„ë™ê¸° ì‘ì—…ì´ UI ì„±ëŠ¥ ìœ ì§€ì— ì¤‘ìš”í•˜ë‹µë‹ˆë‹¤â€¦! ")
> 

### ì£¼ì˜ì‚¬í•­

**persistQueryClientë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ë“  ì¿¼ë¦¬ ë°ì´í„°ê°€ ì§€ì •ëœ ì €ì¥ì†Œì— ìœ ì§€ëœë‹¤. ë”°ë¼ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” ì¿¼ë¦¬ì—ëŠ” ì£¼ì˜í•´ì•¼ í•œë‹¤.**

## 4. ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€ì™€ ìµœì í™” ì „ëµ

### ì–¸ì œ ë©”ëª¨ë¦¬ ìºì‹±ë§Œìœ¼ë¡œ ì¶©ë¶„í• ê¹Œ?

ë‹¨ì¼ ì„¸ì…˜ ë‚´ì—ì„œë§Œ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ë©´ ë˜ëŠ” ê²½ìš°, ê¸°ë³¸ ë©”ëª¨ë¦¬ ìºì‹±ë§Œìœ¼ë¡œë„ ì¶©ë¶„í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ëŒ€ì‹œë³´ë“œë‚˜ ê´€ë¦¬ì í˜ì´ì§€ì²˜ëŸ¼ ì‚¬ìš©ìê°€ í•œ ë²ˆ ë¡œë“œí•œ í›„ ì§€ì†ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” í˜ì´ì§€ì— ì í•©í•˜ë‹¤.

### ì–¸ì œ ì˜êµ¬ ì €ì¥ì´ í•„ìš”í• ê¹Œ?

ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì—ëŠ” ì˜êµ¬ ì €ì¥ì†Œë¥¼ ê³ ë ¤í•´ë³¼ ìˆ˜ ìˆë‹¤:

- ì‚¬ìš©ìê°€ ìì£¼ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” ê²½ìš°
- ì˜¤í”„ë¼ì¸ ì§€ì›ì´ í•„ìš”í•œ ê²½ìš°
- ì´ˆê¸° ë¡œë”© ì‹œê°„ì„ ìµœì†Œí™”í•˜ê³  ì‹¶ì€ ê²½ìš°

### ì„±ëŠ¥ ìµœì í™” íŒ

1. **ì ì ˆí•œ staleTime ì„¤ì •**: ë°ì´í„°ì˜ ë³€ê²½ ë¹ˆë„ì— ë”°ë¼ staleTimeì„ ì¡°ì •í•˜ì—¬ ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì¤„ì¸ë‹¤.
2. **ì„ íƒì  ì˜êµ¬ ì €ì¥**: ëª¨ë“  ì¿¼ë¦¬ë¥¼ ì˜êµ¬ ì €ì¥í•˜ê¸°ë³´ë‹¤ëŠ”, í•„ìš”í•œ ì¿¼ë¦¬ë§Œ ì„ íƒì ìœ¼ë¡œ ì €ì¥í•œë‹¤.
3. **ìºì‹œ í¬ê¸° ê´€ë¦¬**: ë„ˆë¬´ ë§ì€ ë°ì´í„°ë¥¼ ìºì‹œí•˜ë©´ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì ì ˆí•œ gcTimeì„ ì„¤ì •í•˜ì—¬ ìºì‹œ í¬ê¸°ë¥¼ ê´€ë¦¬í•œë‹¤.

```jsx
*// ìì£¼ ë³€ê²½ë˜ëŠ” ë°ì´í„°*
const { data: realtimeData } = useQuery({
  queryKey: ['realtime-stats'],
  queryFn: fetchRealtimeStats,
  staleTime: 1000 * 10, *// 10ì´ˆ*
  gcTime: 1000 * 60, *// 1ë¶„*
})

*// ê±°ì˜ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ë°ì´í„°*
const { data: staticData } = useQuery({
  queryKey: ['static-config'],
  queryFn: fetchStaticConfig,
  staleTime: Infinity, *// í•­ìƒ ì‹ ì„ *
  gcTime: Infinity, *// ì ˆëŒ€ ì‚­ì œí•˜ì§€ ì•ŠìŒ*
})
```

ì´ì œ React Queryì˜ ìºì‹± ë©”ì»¤ë‹ˆì¦˜ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ì•˜ë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ React QueryëŠ” ë©”ëª¨ë¦¬ì— ìºì‹œë¥¼ ì €ì¥í•˜ì§€ë§Œ, í•„ìš”ì— ë”°ë¼ persistQueryClient í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ì—¬ ì˜êµ¬ ì €ì¥ì†Œì— ìºì‹œë¥¼ ìœ ì§€í•  ìˆ˜ ìˆë‹¤. ê° í”„ë¡œì íŠ¸ì˜ ìš”êµ¬ì‚¬í•­ê³¼ ë°ì´í„° íŠ¹ì„±ì— ë§ê²Œ ì ì ˆí•œ ìºì‹± ì „ëµì„ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

> (ğŸ‘¨ğŸ»â€ğŸ« : "ì‚¬ìš©ì ê²½í—˜ì„ ìµœìš°ì„ ìœ¼ë¡œ ìƒê°í•œë‹¤ë©´, ìì£¼ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ë°ì´í„°ëŠ” ì˜êµ¬ ì €ì¥ì†Œì— ìºì‹œí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. **í•˜ì§€ë§Œ ë¯¼ê°í•œ ì •ë³´ëŠ” ì ˆëŒ€ ì €ì¥í•˜ë©´ ì•ˆ ëœë‹¤ëŠ” ì , ê¼­ ê¸°ì–µí•˜ì„¸ìš”! í° í˜ì—ëŠ” í° ì±…ì„ì´ ë”°ë¥¸ë‹µë‹ˆë‹¤.** **ê³ ë ¤í•´ì•¼ í•  ë˜ ë‹¤ë¥¸ ì ì€ ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë§ˆë‹¤ localStorage ìš©ëŸ‰ì´ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.** ì¼ë°˜ì ìœ¼ë¡œ ì¼ìƒì ì¸ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸°ì—ëŠ” ì¢‹ì€ ì˜µì…˜ì´ì§€ë§Œ, ì¼ë°˜ì ì¸ ì €ì¥ í•œë„ê°€ ì•½ 5-10MBì¸ ê²ƒì„ ê³ ë ¤í•˜ë©´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ëŠ” ëŒ€ìš©ëŸ‰ ë°ì´í„°ì…‹ì„ ì €ì¥í•˜ê¸°ì— ìµœì„ ì˜ ì†”ë£¨ì…˜ì´ ì•„ë‹ ìˆ˜ ìˆìœ¼ë©°, ë°ì´í„°ê°€ ë„ˆë¬´ ì»¤ì§ˆ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ì ì ˆí•œ ëŒ€ì²´ ë°©ì•ˆì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.")
> 

> ğŸ™‡ğŸ» ê¸€ ë‚´ì— í‹€ë¦° ì , ì˜¤íƒˆì, ë¹„íŒ, ê³µê° ë“± ëª¨ë‘ ì ì–´ì£¼ì…”ë„ ë©ë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤..! ğŸ™‡ğŸ»
>
